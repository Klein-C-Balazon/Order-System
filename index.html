<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <link rel="stylesheet" href="styles.css">
  <title>Auto Order System — Easy/Hard + Undo</title>
</head>
<body>
  <h1>Order System</h1>

  <h2>Cashier View</h2>
  <div class="flex-row">

  <div class="order-panel">
    <h2>Counter Ordering (F2F)</h2>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Items</th>
          <th>Complexity</th>
          <th>Queue</th>
          <th>Paid?</th>
          <th>Action</th>
        </tr>
      </thead>
      <tbody id="counterTable"></tbody>
    </table>
  </div>

  <div class="order-panel">
    <h2>Online Ordering</h2>
    <table>
      <thead>
        <tr>
          <th>Order ID</th>
          <th>Items</th>
          <th>Complexity</th>
          <th>Queue</th>
          <th>Status</th>
        </tr>
      </thead>
      <tbody id="onlineTable"></tbody>
    </table>
  </div>

</div>

  <p>
    <button id="undoBtn">UNDO</button>
    <b>Last action:</b> <span id="lastAction">None</span>
  </p>

  <h2>Kitchen — Easy</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr><th>Order ID</th><th>Items</th><th>Status</th><th>Preparing</th><th>Ready</th><th>Serve</th></tr>
    </thead>
    <tbody id="easyKitchen"></tbody>
  </table>

  <h2>Kitchen — Hard</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr><th>Order ID</th><th>Items</th><th>Status</th><th>Preparing</th><th>Ready</th><th>Serve</th></tr>
    </thead>
    <tbody id="hardKitchen"></tbody>
  </table>

  <h3>Notifications</h3>
  <div id="notifications">—</div>

<script>
const complexityValues = {
  "Coke":1,"Sprite":1,"Iced Tea":2,
  "Fries":3,"Chicken Nuggets":4,"Nachos":5,"Chicken Poppers":5,"Salad":6,
  "Hotdog":4,"Burger":6,"Burger Steak":7,"Fried Chicken":7,"Chicken Wings":8,"Buttered Shrimp":9,"Steak":10,
  "Ice Cream":1,"Brownies":2,"Mango Graham":3,"Blueberry Cheesecake":3,"Tiramisu":4
};
const menuItems = Object.keys(complexityValues);

let nextId = 1;
let cashierOrders = [];
let easyQueue = [];
let hardQueue = [];
let actionStack = [];

/* NEW ARRAYS FOR TWO NEW TABLES */
let counterOrders = [];
let onlineOrders = [];

const notifyEl = document.getElementById('notifications');
function notify(msg) { notifyEl.textContent = msg; }
function clone(o){ return JSON.parse(JSON.stringify(o)); }
function pushAction(action){ actionStack.push(clone(action)); document.getElementById('lastAction').innerText=action.type; }

function computeComplexity(items){ return items.reduce((s,i)=>s+(complexityValues[i.name]||0)*i.qty,0); }
function classifyOrder(order){ 
  const score=computeComplexity(order.items); 
  order.complexity=score; 
  order.queue=score>10?"Hard":"Easy"; 
}

/* --------------------------------------------------------------------------
   TEMPORARY ORDER GENERATOR (TEMPORATY TIL REPLACED)
   --------------------------------------------------------------------------
   This block SIMULATES incoming customers for demo/testing purposes.

   • Math.random() < 0.25
         → Means a 25% chance every 3 seconds to create a new order
         → You can adjust the 0.25 to make orders appear more or less often

   • const isOnline = Math.random() < 0.5;
         → 50% chance customer is ONLINE
         → 50% chance customer is COUNTER/F2F
         → This simulates the decision in your diagram

   ★ IMPORTANT:
     Replace this whole block later when the REAL customer input code
     (API, socket, scanner, kiosk, mobile app, etc.) is integrated.
   -------------------------------------------------------------------------- */
setInterval(()=>{
  if(Math.random() < 0.25){  // 25% chance to spawn a new random order

    const nItems = Math.floor(Math.random()*2)+1;
    const items = [];
    for(let i=0;i<nItems;i++){
      const it = menuItems[Math.floor(Math.random()*menuItems.length)];
      const q = Math.floor(Math.random()*3)+1;
      items.push({name:it, qty:q});
    }

    /* -------------
       TEMPORARY: Determine customer type randomly (TEMPORATY TIL REPLACED)
       50% online, 50% counter
    ------------- */
    const isOnline = Math.random() < 0.5;

    const order = {
      id: nextId++,
      items,
      paid: false,
      status: isOnline ? "Online Received" : "Waiting for Payment"
    };

    classifyOrder(order);

    if(isOnline){
      onlineOrders.push(order);
      notify(`ONLINE ORDER #${order.id}`);

      // Auto-route to kitchen after short delay (simulating instant payment)
      setTimeout(()=>sendToKitchen(order,"online"), 600);

    } else {
      counterOrders.push(order);
      notify(`COUNTER ORDER #${order.id}`);
    }

    renderAll();
  }
},3000);
/* ---------------- END OF TEMPORARY SYSTEM -------------------------- */


/* ---------- SEND TO KITCHEN LOGIC (UNCHANGED) ---------- */
function sendToKitchen(order, source){

  counterOrders = counterOrders.filter(o=>o.id!==order.id);
  onlineOrders = onlineOrders.filter(o=>o.id!==order.id);
  cashierOrders = cashierOrders.filter(o=>o.id!==order.id);

  classifyOrder(order);
  order.status = "Paid";

  if(order.queue==="Easy") easyQueue.push(order); 
  else hardQueue.push(order);

  notify(`Order #${order.id} sent to kitchen (${order.queue}) via ${source}.`);
  renderAll();
}

/* KEEP YOUR CASHIER BUTTONS UNTOUCHED */
function markPaid(id){ 
  let o = counterOrders.find(x=>x.id===id);
  if(o) sendToKitchen(o,"f2f"); 
}

function markOnline(id){ 
  const idx=cashierOrders.findIndex(o=>o.id===id); 
  if(idx===-1)return; 
  cashierOrders[idx].onlinePay=true; 
  notify(`Checking order #${cashierOrders[idx].id} (online)...`); 
  setTimeout(()=>sendToKitchen(cashierOrders[idx],"online"),600); 
}

/* KITCHEN ACTIONS (UNCHANGED) */
function setPreparing(id,queueType){
  const q=queueType==="Easy"?easyQueue:hardQueue; 
  const o=q.find(x=>x.id===id); 
  if(!o)return; 
  o.status="Preparing"; 
  notify(`Order #${o.id} set to Preparing`);
  renderAll();
}

function setReady(id,queueType){
  const q=queueType==="Easy"?easyQueue:hardQueue; 
  const o=q.find(x=>x.id===id); 
  if(!o)return; 
  o.status="Ready"; 
  notify(`Order #${o.id} set to Ready`);
  renderAll();
}

function serveOrder(id,queueType){
  const q=queueType==="Easy"?easyQueue:hardQueue;
  const idx=q.findIndex(o=>o.id===id); 
  if(idx===-1)return;
  q.splice(idx,1);
  notify(`Order #${id} served`);
  renderAll();
}

/* ---------- RENDER UPDATED UI INCLUDING NEW TABLES ---------- */
function renderAll(){

  /* COUNTER TABLE */
  const counterT=document.getElementById('counterTable');
  counterT.innerHTML="";
  counterOrders.forEach(o=>{
    const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", ");
    counterT.innerHTML += `
      <tr>
        <td>${o.id}</td>
        <td>${items}</td>
        <td>${o.complexity}</td>
        <td>${o.queue}</td>
        <td>${o.paid?"Yes":"No"}</td>
        <td><button onclick="markPaid(${o.id})">Pay</button></td>
      </tr>
    `;
  });

  /* ONLINE TABLE */
  const onlineT=document.getElementById('onlineTable');
  onlineT.innerHTML="";
  onlineOrders.forEach(o=>{
    const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", ");
    onlineT.innerHTML += `
      <tr>
        <td>${o.id}</td>
        <td>${items}</td>
        <td>${o.complexity}</td>
        <td>${o.queue}</td>
        <td>${o.status}</td>
      </tr>
    `;
  });

  /* ORIGINAL KITCHEN RENDERING (UNCHANGED) */
  const easyT=document.getElementById('easyKitchen'); easyT.innerHTML="";
  easyQueue.forEach(o=>{
    const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", ");
    easyT.innerHTML+=`
      <tr>
        <td>${o.id}</td>
        <td>${items}</td>
        <td>${o.status||"Paid"}</td>
        <td><button onclick="setPreparing(${o.id}, 'Easy')">Preparing</button></td>
        <td><button onclick="setReady(${o.id}, 'Easy')">Ready</button></td>
        <td><button onclick="serveOrder(${o.id}, 'Easy')">Serve</button></td>
      </tr>`;
  });

  const hardT=document.getElementById('hardKitchen'); hardT.innerHTML="";
  hardQueue.forEach(o=>{
    const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", ");
    hardT.innerHTML+=`
      <tr>
        <td>${o.id}</td>
        <td>${items}</td>
        <td>${o.status||"Paid"}</td>
        <td><button onclick="setPreparing(${o.id}, 'Hard')">Preparing</button></td>
        <td><button onclick="setReady(${o.id}, 'Hard')">Ready</button></td>
        <td><button onclick="serveOrder(${o.id}, 'Hard')">Serve</button></td>
      </tr>`;
  });
}

document.getElementById('undoBtn').addEventListener('click', ()=>undo());
window.markPaid=markPaid; 
window.markOnline=markOnline;
window.setPreparing=setPreparing; 
window.setReady=setReady; 
window.serveOrder=serveOrder;
window.renderAll=renderAll;

renderAll();
</script>
