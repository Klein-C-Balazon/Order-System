<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
    <link rel="stylesheet" href="styles.css">
  <title>Auto Order System — Easy/Hard + Undo</title>
</head>
<body>
  <h1>Order System</h1>

  <h2>Cashier View</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr>
        <th>Order ID</th>
        <th>Items</th>
        <th>Complexity</th>
        <th>Queue</th>
        <th>Paid?</th>
        <th>Actions</th>
        <th>Online Pay (check & route)</th>
      </tr>
    </thead>
    <tbody id="cashierTable"></tbody>
  </table>

  <p>
    <button id="undoBtn">UNDO</button>
    <b>Last action:</b> <span id="lastAction">None</span>
  </p>

  <h2>Kitchen — Easy</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr><th>Order ID</th><th>Items</th><th>Status</th><th>Preparing</th><th>Ready</th><th>Serve</th></tr>
    </thead>
    <tbody id="easyKitchen"></tbody>
  </table>

  <h2>Kitchen — Hard</h2>
  <table border="1" cellpadding="6">
    <thead>
      <tr><th>Order ID</th><th>Items</th><th>Status</th><th>Preparing</th><th>Ready</th><th>Serve</th></tr>
    </thead>
    <tbody id="hardKitchen"></tbody>
  </table>

  <h3>Notifications</h3>
  <div id="notifications">—</div>

<script>
const complexityValues = {
  "Coke":1,"Sprite":1,"Iced Tea":2,
  "Fries":3,"Chicken Nuggets":4,"Nachos":5,"Chicken Poppers":5,"Salad":6,
  "Hotdog":4,"Burger":6,"Burger Steak":7,"Fried Chicken":7,"Chicken Wings":8,"Buttered Shrimp":9,"Steak":10,
  "Ice Cream":1,"Brownies":2,"Mango Graham":3,"Blueberry Cheesecake":3,"Tiramisu":4
};
const menuItems = Object.keys(complexityValues);

let nextId = 1;
let cashierOrders = [];
let easyQueue = [];
let hardQueue = [];
let actionStack = [];

const notifyEl = document.getElementById('notifications');
function notify(msg) { notifyEl.textContent = msg; }
function clone(o){ return JSON.parse(JSON.stringify(o)); }
function pushAction(action){ actionStack.push(clone(action)); document.getElementById('lastAction').innerText=action.type; }

function computeComplexity(items){ return items.reduce((s,i)=>s+(complexityValues[i.name]||0)*i.qty,0); }
function classifyOrder(order){ const score=computeComplexity(order.items); order.complexity=score; order.queue=score>10?"Hard":"Easy"; }

function sendToKitchen(order, source){
  cashierOrders = cashierOrders.filter(o=>o.id!==order.id);
  easyQueue = easyQueue.filter(o=>o.id!==order.id);
  hardQueue = hardQueue.filter(o=>o.id!==order.id);

  classifyOrder(order);
  order.status = "Paid";
  if(order.queue==="Easy") easyQueue.push(order); else hardQueue.push(order);

  pushAction({ type: source==="online"?"OnlinePayment":"SendToKitchen", payload:{ order: clone(order), source } });
  notify(`Order #${order.id} sent to kitchen (${order.queue}) via ${source}.`);
  renderAll();
}

// ---------------- Randomized live orders
setInterval(()=>{
  if(Math.random()<0.25){
    const nItems=Math.floor(Math.random()*2)+1;
    const items=[];
    for(let i=0;i<nItems;i++){
      const it=menuItems[Math.floor(Math.random()*menuItems.length)];
      const q=Math.floor(Math.random()*3)+1;
      items.push({ name: it, qty: q });
    }
    const order={ id: nextId++, items, complexity:0, queue:"", paid:false, onlinePay:false, status:"New (live)"};
    classifyOrder(order);
    cashierOrders.push(order);
    pushAction({ type:"AddOrder", payload:{ order: clone(order) }});
    notify(`Live incoming order #${order.id} (score ${order.complexity})`);
    renderAll();
  }
},3000);

// ---------------- Cashier actions
function markPaid(id){ const idx=cashierOrders.findIndex(o=>o.id===id); if(idx===-1)return; sendToKitchen(cashierOrders[idx],"paid"); }
function markOnline(id){ const idx=cashierOrders.findIndex(o=>o.id===id); if(idx===-1)return; cashierOrders[idx].onlinePay=true; notify(`Checking order #${cashierOrders[idx].id} (online)...`); setTimeout(()=>sendToKitchen(cashierOrders[idx],"online"),600); }

// ---------------- Kitchen actions
function setPreparing(id,queueType){ const q=queueType==="Easy"?easyQueue:hardQueue; const o=q.find(x=>x.id===id); if(!o)return; const prev={status:o.status}; o.status="Preparing"; pushAction({ type:"UpdateOrder", payload:{ id:o.id, prev } }); notify(`Order #${o.id} set to Preparing`); renderAll(); }
function setReady(id,queueType){ const q=queueType==="Easy"?easyQueue:hardQueue; const o=q.find(x=>x.id===id); if(!o)return; const prev={status:o.status}; o.status="Ready"; pushAction({ type:"UpdateOrder", payload:{ id:o.id, prev } }); notify(`Order #${o.id} set to Ready`); renderAll(); }
function serveOrder(id,queueType){ const q=queueType==="Easy"?easyQueue:hardQueue; const idx=q.findIndex(o=>o.id===id); if(idx===-1)return; const removed=q.splice(idx,1)[0]; pushAction({ type:"RemoveOrder", payload:{ order: clone(removed), queue: queueType } }); notify(`Order #${removed.id} served and removed from ${queueType}`); renderAll(); }

// ---------------- UNDO logic
function undo(){
  if(actionStack.length===0){ alert("Nothing to undo."); return; }
  const act=actionStack.pop();
  document.getElementById('lastAction').innerText=actionStack.length?actionStack[actionStack.length-1].type:"None";
  const t=act.type; const payload=act.payload;
  if(t==="AddOrder"){ const id=payload.order.id; cashierOrders=cashierOrders.filter(o=>o.id!==id); easyQueue=easyQueue.filter(o=>o.id!==id); hardQueue=hardQueue.filter(o=>o.id!==id); notify(`Undo AddOrder: order #${id} removed`);}
  else if(t==="SendToKitchen" || t==="OnlinePayment"){ const id=payload.order.id; easyQueue=easyQueue.filter(o=>o.id!==id); hardQueue=hardQueue.filter(o=>o.id!==id); const restored=clone(payload.order); restored.paid=(t==="SendToKitchen")?false:restored.paid; restored.onlinePay=(t==="OnlinePayment"); cashierOrders.push(restored); notify(`Undo ${t}: order #${id} returned to cashier`);}
  else if(t==="UpdateOrder"){ const id=payload.id; let o=easyQueue.find(x=>x.id===id)||hardQueue.find(x=>x.id===id); if(o){o.status=payload.prev.status; notify(`Undo UpdateOrder: order #${id} restored to ${o.status}`);} else {notify(`Undo UpdateOrder: order #${id} not in queue`);}}
  else if(t==="RemoveOrder"){ const restored=clone(payload.order); const queueType=payload.queue; if(queueType==="Easy") easyQueue.push(restored); else hardQueue.push(restored); notify(`Undo RemoveOrder: order #${restored.id} restored to ${queueType}`);}
  renderAll();
}

// ---------------- Render UI
function renderAll(){
  const cT=document.getElementById('cashierTable'); cT.innerHTML="";
  cashierOrders.forEach(o=>{ const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", "); const tr=document.createElement('tr'); tr.innerHTML=`
    <td>${o.id}</td>
    <td>${items}</td>
    <td>${computeComplexity(o.items)}</td>
    <td>${(computeComplexity(o.items)>10)?"Hard":"Easy"}</td>
    <td>${o.paid?"Yes":"No"}</td>
    <td><button onclick="markPaid(${o.id})">Mark Paid</button></td>
    <td><button onclick="markOnline(${o.id})">Online Pay</button></td>
  `; cT.appendChild(tr); });

  const easyT=document.getElementById('easyKitchen'); easyT.innerHTML=""; easyQueue.forEach(o=>{ const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", "); const tr=document.createElement('tr'); tr.innerHTML=`
    <td>${o.id}</td>
    <td>${items}</td>
    <td>${o.status||"Paid"}</td>
    <td><button onclick="setPreparing(${o.id}, 'Easy')">Preparing</button></td>
    <td><button onclick="setReady(${o.id}, 'Easy')">Ready</button></td>
    <td><button onclick="serveOrder(${o.id}, 'Easy')">Serve</button></td>
  `; easyT.appendChild(tr); });

  const hardT=document.getElementById('hardKitchen'); hardT.innerHTML=""; hardQueue.forEach(o=>{ const items=o.items.map(i=>`${i.name} (${i.qty})`).join(", "); const tr=document.createElement('tr'); tr.innerHTML=`
    <td>${o.id}</td>
    <td>${items}</td>
    <td>${o.status||"Paid"}</td>
    <td><button onclick="setPreparing(${o.id}, 'Hard')">Preparing</button></td>
    <td><button onclick="setReady(${o.id}, 'Hard')">Ready</button></td>
    <td><button onclick="serveOrder(${o.id}, 'Hard')">Serve</button></td>
  `; hardT.appendChild(tr); });
}

document.getElementById('undoBtn').addEventListener('click', ()=>undo());
window.markPaid=markPaid; window.markOnline=markOnline;
window.setPreparing=setPreparing; window.setReady=setReady; window.serveOrder=serveOrder;
window.undoAction=undo; window.renderAll=renderAll;
renderAll();
</script>
</body>
</html>
